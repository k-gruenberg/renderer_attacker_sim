<!DOCTYPE html>
<html>
	<head>
		<title>Exploit Console</title>
	</head>
	<body>

		<script>
			window.addEventListener("message", event => {
				if (event.data && event.data.type === "FROM_EXTENSION") {
					if (event.data.resp === "responseAttackerReadExtensionStorageLocal") {
						document.getElementById('ext-storage').textContent = JSON.stringify(event.data.payload, null, 4);
					} else if (event.data.resp === "responseAttackerSendMessage") {
						document.getElementById('ext-message-response').textContent = JSON.stringify(event.data.payload, null, 4);
					}
				}
			});

			function read_ext_storage() {
				window.postMessage({type: "FROM_PAGE", req: "attackerReadExtensionStorageLocal"});
			}

			function write_ext_storage() {
				try {
					let key = document.getElementById("key-tf").value;
					let value = JSON.parse(document.getElementById("value-tf").value);
					window.postMessage({type: "FROM_PAGE", req: "attackerWriteExtensionStorageLocal", key: key, value: value});
					document.getElementById("ext-storage-error").innerText = "";
				} catch (error) {
					document.getElementById("ext-storage-error").innerText = error;
				}
			}

			function send_ext_message() {
				try {
					let message = JSON.parse(document.getElementById("ext-message").value);
					window.postMessage({type: "FROM_PAGE", req: "attackerSendMessage", payload: message});
					document.getElementById("ext-message-error").innerText = "";
				} catch (error) {
					document.getElementById("ext-message-error").innerText = error;
				}
			}
		</script>

		<h1>Renderer Attacker Exploit Console</h1>

		<b>For this console to work, you need to append the content of <code>code_snippet.js</code>
		to the content script of the extension to test.</b>

		<br/><br/>

		<h2>Extension Storage (Local)</h2>
		<textarea readonly id="ext-storage" style="font-family: monospace;" rows="10" cols="100"></textarea>
		<br/>
		<button type="button" onclick="read_ext_storage();">Read extension storage</button><br/>
		<input type="text" id="key-tf" size="30" style="font-family: monospace;" placeholder="key" />:
		<input type="text" id="value-tf" size="30" style="font-family: monospace;" placeholder="value JSON" />
		<button type="button" onclick="write_ext_storage();">Write extension storage</button>
		<span id="ext-storage-error" style="color:red"></span>

		<br/><br/>

		<h2>Extension Message</h2>
		<textarea id="ext-message" style="font-family: monospace;" rows="10" cols="70" placeholder="message JSON"></textarea>
		-----&gt;
		<textarea readonly id="ext-message-response" style="font-family: monospace;" rows="10" cols="70" placeholder="response JSON"></textarea>
		<br/>
		<button type="button" onclick="send_ext_message();">Send extension message</button>
		<span id="ext-message-error" style="color:red"></span>

	</body>
</html>
